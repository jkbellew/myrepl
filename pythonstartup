"""My Personal REPL set up"""
import sys
import readline
import atexit

from pathlib import Path
from rich import pretty, traceback
from rich import print as println
from os import system


def save_history():
    readline.write_history_file(history_file)


def cls(stmt: str=None) -> None:
    system("cls")
    if stmt is not None:
        println(stmt)


def clear() -> None:
    system("cls")


def run(pyfile: str | Path) -> None:
    if type(pyfile) is str:
        pyfile = Path(pyfile)
        if not pyfile.is_file():
            println("\n[bold red]ERROR IN PROGRAM.[/bold red]\n")
        else:
            exec(compile(pyfile.open().read(), "<string>","exec"))
            println("\n[bold green]END OF PROGRAM.[/bold green]\n")


def load_settings() -> None:
    cls(initial_stmt)
    if history_file.exists():
        readline.read_history_file(history_file)
    else:
        history_file.touch()


history_file = Path.home() / ".pyhistory"

sys.ps1 = "\033[32mpy> "
sys.ps2 = "py| "

readline.parse_and_bind("tab: complete")
pretty.install()
traceback.install(show_locals=False)

initial_stmt: str = "[bold green]Welcome to the Python REPL[/bold green]"

load_settings()

atexit.register(save_history)  # need atexit module
